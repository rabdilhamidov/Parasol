$(function(){var price=200,order_form_popup=$(".popup-order-form"),steps=$(".form-content"),step1=$(order_form_popup).find(".form-content#step-1"),step2=$(order_form_popup).find(".form-content#step-2"),step3=$(order_form_popup).find(".form-content#step-3"),arr_steps=$(order_form_popup).find(".head-block a.steps"),arr_step1=$(order_form_popup).find(".head-block a.step-1"),arr_step2=$(order_form_popup).find(".head-block a.step-2"),arr_step3=$(order_form_popup).find(".head-block a.step-3"),prev_activ_step=$(order_form_popup).find(".head-block a.step-1"),order_form=function(event){event.preventDefault(),$(order_form_popup).fadeIn(300)},steps_nav=function(event){function onAjaxSuccess(data){if($(order_form_popup).fadeOut(300),"Онлайн (Monexy)"==form_data.payment){var sum=form_data.quantity*price;location="/wp-content/themes/parasol/to_monexy.php?sum="+sum}else alert(data)}function validate_step2(){var regsObj={EMAIL:/^[a-z0-9](?:[a-z0-9_\.-]*[a-z0-9])*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])*\.)+[a-z]{2,4}$/i,TEL:/^[0-9 \,\;\-\+\(\)\[\]]+$/i,EN_RU:/^[a-zA-Zа-яА-ЯёЁ _-]+$/i,EN_RU_D:/^[a-zA-Zа-яА-ЯёЁ0-9 _-]+$/i},is_err=!1;return $("#step-2 span.err").hide(),regsObj.EN_RU.test(form_data.username)||($("label[for=username] span.err").show(),is_err=!0),regsObj.EN_RU.test(form_data.surname)||($("label[for=surname] span.err").show(),is_err=!0),regsObj.EMAIL.test(form_data.email)||($("label[for=email] span.err").show(),is_err=!0),regsObj.TEL.test(form_data.phone)||($("label[for=phone] span.err").show(),is_err=!0),regsObj.EN_RU.test(form_data.city)||($("label[for=city] span.err").show(),is_err=!0),regsObj.EN_RU.test(form_data.street)||($("label[for=street] span.err").show(),is_err=!0),regsObj.EN_RU_D.test(form_data.house)||($("label[for=house] span.err").show(),is_err=!0),regsObj.EN_RU_D.test(form_data.flat)||($("label[for=flat] span.err").show(),is_err=!0),is_err}function validate_step1(){var is_err=!1;return $("#step-1 span.err").hide(),form_data.delivery||(is_err="Не выбрана доставка",$("#step-1 span.err").show()),is_err}function validate_step3(){var is_err=!1;return form_data.quantity||(is_err="Не выбрано количество. "),form_data.payment||(is_err+="Не выбран способ оплаты."),is_err}event.preventDefault();var form_data={delivery:$("input[name=delivery]:checked").val(),username:$("#username").val(),surname:$("#surname").val(),email:$("#email").val(),phone:$("#phone").val(),city:$("#city").val(),street:$("#street").val(),house:$("#house").val(),flat:$("#flat").val(),quantity:$("#quantity input").val(),payment:$("#payment input").val()};if(prev_activ_step=$(".head-block").find("a.active"),!(prev_activ_step.hasClass("step-1")&&(is_err=validate_step1())||prev_activ_step.hasClass("step-2")&&(is_err=validate_step2()))){if($(arr_steps).removeClass("active"),$(steps).fadeOut(0),$(this).hasClass("step-1")&&($(step1).fadeIn(300),$(arr_step1).addClass("active")),$(this).hasClass("step-2")&&($(step2).fadeIn(300),$(arr_step2).addClass("active")),$(this).hasClass("step-3")||$(this).hasClass("submit")){$(step3).fadeIn(300),$(arr_step3).addClass("active");var sum=200*$("input[name=quantity]").val();$(".summa").html("<strong>Сумма:</strong> "+sum+" грн")}if($(this).hasClass("submit"))if($("input#rules").prop("checked")){if(is_err_1=validate_step1(),is_err_2=validate_step2(),is_err_3=validate_step3(),is_err_1&&alert("Ошибка ввода на первом шаге: "+is_err_1),is_err_2&&alert("Ошибка ввода на втором шаге"),is_err_3&&alert("Ошибка ввода на третьем шаге: "+is_err_3),!is_err_1&&!is_err_2&!is_err_3){var script="/wp-content/themes/parasol/ajax_send_order.php";$.post(script,form_data,onAjaxSuccess)}}else alert("Предварительно Вы должны ознакомиться с правилами предоставления услуг.")}},get_sum=function(event){event.preventDefault();var sum=$(this).text()*price;$(".summa").html("<strong>Сумма:</strong> "+sum+" грн")};$(document).ready(function(){}).on("click","a.buy-card",order_form).on("click",".pof.x-close",function(event){event.preventDefault(),$(order_form_popup).fadeOut(300)}).on("click","a.steps",steps_nav).on("mouseup",".drop-down#quantity ul li",get_sum)});